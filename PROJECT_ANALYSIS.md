# üìä –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ —É–ª—É—á—à–µ–Ω–∏—è

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025  
**–í–µ—Ä—Å–∏—è TanStack Query:** v5.90.5  
**Next.js:** 15.5.6

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ

1. **SSR Hydration** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, –¥–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏ –≥–∏–¥—Ä–∞—Ç–∏—Ä—É—é—Ç—Å—è
2. **–ù–∞–≤–∏–≥–∞—Ü–∏—è** - prefetch —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, intercepting routes –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. **loading.tsx** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
4. **QueryClient –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è SSR –∏ Next.js App Router
5. **PostModal –æ—Ç–∫—Ä—ã—Ç–∏–µ** - —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ intercepting routes, —Å–∫–µ–ª–µ—Ç–æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: CommentsList –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç Spinner –≤–º–µ—Å—Ç–æ —Å–∫–µ–ª–µ—Ç–æ–Ω–∞

**–§–∞–π–ª:** `src/features/posts/post-comments/ui/CommentsList.tsx:20-25`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `Spinner` (–ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ª–æ–∞–¥–µ—Ä) –≤–º–µ—Å—Ç–æ —Å–∫–µ–ª–µ—Ç–æ–Ω–∞
- –ü—Ä–∏ SSR –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —É–∂–µ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω—ã, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è Spinner
- –ü–ª–æ—Ö–æ–π UX - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–ø–∏–Ω–Ω–µ—Ä –≤–º–µ—Å—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

**–†–µ—à–µ–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å `CommentsSkeleton` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏.

---

### 2. ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: useEditPost –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π queryKey

**–§–∞–π–ª:** `src/features/posts/edit-post/api/use-edit-post.ts:12`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
queryClient.invalidateQueries({ queryKey: ['posts'] })
```
- –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç `['posts']`, –Ω–æ —Ç–∞–∫–æ–≥–æ queryKey –Ω–µ—Ç –≤ –ø—Ä–æ–µ–∫—Ç–µ
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è: `['user-posts', userId, pageSize]` –∏ `['post', postId]`
- –õ–∏—à–Ω–∏–π –≤—ã–∑–æ–≤ –±–µ–∑ —ç—Ñ—Ñ–µ–∫—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:**
–£–±—Ä–∞—Ç—å –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—é `['posts']` –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π queryKey.

---

### 3. ‚úÖ –•–æ—Ä–æ—à–æ: –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ prefetch

**–§–∞–π–ª—ã:**
- `HomePostsList.tsx:65` - `prefetch={true}` ‚úÖ
- `PostImageSlider.tsx:123` - `prefetch={true}` ‚úÖ
- `loading.tsx` —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚úÖ

**–°—Ç–∞—Ç—É—Å:** –ù–∞–≤–∏–≥–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞, prefetch —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

### 4. ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ refetch

**–§–∞–π–ª—ã:**
- `get-query-client.ts:22-24` - –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- `usePost.ts:20-21` - –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
- `useComments.ts` - –Ω–µ—Ç —è–≤–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ)

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ `refetchOnMount: false` –∏ `refetchOnWindowFocus: false` –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ —Ö—É–∫–∞—Ö, —Ö–æ—Ç—è —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:**
–£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ —Ö—É–∫–æ–≤, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.

---

### 5. ‚úÖ –•–æ—Ä–æ—à–æ: SSR Hydration —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–°—Ç–∞—Ç—É—Å:**
- `prefetchPostWithComments` –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ ‚úÖ
- `HydrationBoundary` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ‚úÖ
- `loading.tsx` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ ‚úÖ
- queryKey —Å–æ–≤–ø–∞–¥–∞—é—Ç –º–µ–∂–¥—É prefetch –∏ useQuery ‚úÖ

---

### 6. ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: useEditPost –º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ setQueryData

**–§–∞–π–ª:** `src/features/posts/edit-post/api/use-edit-post.ts`

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
onSuccess: (_, variables) => {
  queryClient.invalidateQueries({ queryKey: ['posts'] })
  queryClient.invalidateQueries({ queryKey: ['post', variables.postId] })
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç refetch, –¥–∞–∂–µ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –µ—Å—Ç—å
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `setQueryData` –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å optimistic update —á–µ—Ä–µ–∑ `setQueryData` –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI.

---

### 7. ‚úÖ –•–æ—Ä–æ—à–æ: PostModal –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

**–°—Ç–∞—Ç—É—Å:**
- Intercepting route `(.)[postId]` —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
- `loading.tsx` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ ‚úÖ
- –°–∫–µ–ª–µ—Ç–æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚úÖ
- SSR hydration —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚úÖ

---

### 8. ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: showSkeleton –ª–æ–≥–∏–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–ø—Ä–æ—â–µ–Ω–∞

**–§–∞–π–ª:** `PostModal.tsx:58`

**–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞:**
```typescript
const showSkeleton = (isLoading || (isFetching && !post)) && !post
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –£—Å–ª–æ–≤–∏–µ `&& !post` –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è
- –ú–æ–∂–Ω–æ —É–ø—Ä–æ—Å—Ç–∏—Ç—å –¥–æ: `isLoading && !post`

**–†–µ—à–µ–Ω–∏–µ:**
–£–ø—Ä–æ—Å—Ç–∏—Ç—å –ª–æ–≥–∏–∫—É, —Ç–∞–∫ –∫–∞–∫ `isFetching && !post` —É–∂–µ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç—Å—è `isLoading && !post`.

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. ‚úÖ –°–æ–∑–¥–∞–Ω CommentsSkeleton
- **–§–∞–π–ª:** `src/shared/ui/skeleton/CommentsSkeleton.tsx`
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–µ–Ω `Spinner` –Ω–∞ `CommentsSkeleton` –≤ `CommentsList`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –õ—É—á—à–∏–π UX - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤–º–µ—Å—Ç–æ —Å–ø–∏–Ω–Ω–µ—Ä–∞

### 2. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω useEditPost
- **–§–∞–π–ª:** `src/features/posts/edit-post/api/use-edit-post.ts`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - –£–±—Ä–∞–Ω–∞ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ `['posts']`
  - –î–æ–±–∞–≤–ª–µ–Ω `setQueryData` –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ queryKey
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –±–µ–∑ –ª–∏—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### 3. ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ showSkeleton
- **–§–∞–π–ª:** `src/features/posts/view-post/PostModal.tsx`
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å `(isLoading || (isFetching && !post)) && !post` –¥–æ `isLoading && !post`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π –∫–æ–¥

### 4. ‚úÖ –£–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- **–§–∞–π–ª:** `src/entities/posts/model/usePost.ts`
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –£–±—Ä–∞–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ `refetchOnMount` –∏ `refetchOnWindowFocus` (–Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è, –ø—Ä–æ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

---

## üìã –û—Å—Ç–∞–≤—à–∏–µ—Å—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. **–î–æ–±–∞–≤–∏—Ç—å optimistic updates –¥–ª—è delete** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `setQueryData` –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ UI
2. **–†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `onMutate`** - –¥–ª—è –æ—Ç–º–µ–Ω—ã pending –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–µ—Ä–µ–¥ optimistic update
3. **–î–æ–±–∞–≤–∏—Ç—å error boundaries** - –¥–ª—è –ª—É—á—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –ø—Ä–∏ SSR

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ:
- SSR Hydration —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ù–∞–≤–∏–≥–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å prefetch
- loading.tsx –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
- PostModal –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ù–µ—Ç –ª–∏—à–Ω–∏—Ö –ø–µ—Ä–µ–∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –∫–ª–∏–∫–∞—Ö

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
- CommentsList —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∫–µ–ª–µ—Ç–æ–Ω
- useEditPost –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- –£–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–∫–∞–∑–∞ —Å–∫–µ–ª–µ—Ç–æ–Ω–∞

### üéØ –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ production!
–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, –∫–æ–¥ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω —Å–æ–≥–ª–∞—Å–Ω–æ best practices 2025.
