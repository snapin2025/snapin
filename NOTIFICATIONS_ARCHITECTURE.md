# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
4. [–ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö](#–ø–æ—Ç–æ–∫–∏-–¥–∞–Ω–Ω—ã—Ö)
5. [API](#api)
6. [WebSocket](#websocket)
7. [–ü–∞–≥–∏–Ω–∞—Ü–∏—è](#–ø–∞–≥–∏–Ω–∞—Ü–∏—è)
8. [–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞](#—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞)
9. [–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏](#–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)
10. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

---

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏—Ö –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö:

- **Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** —á–µ—Ä–µ–∑ WebSocket
- **Infinite scroll –ø–∞–≥–∏–Ω–∞—Ü–∏—è** –ø–æ 100 —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- **–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ—Ç–∫–ª–∏–∫–∞ UI
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞** (–Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ –≤–≤–µ—Ä—Ö—É)
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è** —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ ID
- **FSD –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** (Feature-Sliced Design)

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ entities/notification/          # Entity —Å–ª–æ–π (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notification.ts         # API –º–µ—Ç–æ–¥—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ notification-types.ts   # TypeScript —Ç–∏–ø—ã
‚îÇ   ‚îú‚îÄ‚îÄ model/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useNotifications.ts     # –ì–ª–∞–≤–Ω—ã–π —Ö—É–∫
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ socket/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ getSocket.ts        # WebSocket singleton
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ subscribeToEvent.ts # –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ index.ts                    # Public API
‚îÇ
‚îî‚îÄ‚îÄ widgets/notifications/          # Widget —Å–ª–æ–π (UI –∫–æ–º–ø–æ–∑–∏—Ü–∏—è)
    ‚îî‚îÄ‚îÄ ui/
        ‚îú‚îÄ‚îÄ NotificationBell.tsx    # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫–∞
        ‚îî‚îÄ‚îÄ NotificationBell.module.css
```

### –°–ª–æ–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    UI Layer                         ‚îÇ
‚îÇ              NotificationBell.tsx                   ‚îÇ
‚îÇ  - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞                               ‚îÇ
‚îÇ  - Infinite scroll                                  ‚îÇ
‚îÇ  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 Business Logic Layer                ‚îÇ
‚îÇ              useNotifications Hook                  ‚îÇ
‚îÇ  - React Query (infinite query)                     ‚îÇ
‚îÇ  - WebSocket –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è                             ‚îÇ
‚îÇ  - –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è                         ‚îÇ
‚îÇ  - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   API Layer                         ‚îÇ
‚îÇ              notificationApi                        ‚îÇ
‚îÇ  - HTTP –∑–∞–ø—Ä–æ—Å—ã (getAll, markAsRead)                ‚îÇ
‚îÇ  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. `useNotifications` Hook

**–§–∞–π–ª:** `src/entities/notification/model/useNotifications.ts`

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- Infinite query –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
- WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

**–í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**

```typescript
{
  notifications: Notification[]      // –ü–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ (–Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –≤–≤–µ—Ä—Ö—É)
  unreadCount: number                // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
  isLoading: boolean                 // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  isFetchingNextPage: boolean        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  hasNextPage: boolean               // –ï—Å—Ç—å –ª–∏ –µ—â–µ –¥–∞–Ω–Ω—ã–µ
  fetchNextPage: () => Promise       // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  markAsRead: (id, isRead) => void   // –ü–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
}
```

**–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**

```typescript
export const useNotifications = () => {
  // 1. React Query Client
  const queryClient = useQueryClient()

  // 2. Infinite Query (–ø–∞–≥–∏–Ω–∞—Ü–∏—è)
  const notificationsQuery = useInfiniteQuery({
    queryKey: ['notifications', 'infinite', 100],
    queryFn: ({ pageParam }) => notificationApi.getAll({
      cursor: pageParam,
      pageSize: 100,
      unreadFirst: true
    }),
    getNextPageParam: (lastPage) => {
      // Cursor = ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
      return lastPage.items[lastPage.items.length - 1]?.id
    }
  })

  // 3. Mutation (–ø–æ–º–µ—Ç–∫–∞ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ)
  const markAsReadMutation = useMutation({
    mutationFn: (ids) => notificationApi.markAsRead(ids),
    onMutate: async (ids) => {
      // –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    },
    onError: (error, variables, context) => {
      // –û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
    }
  })

  // 4. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (–Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –≤–≤–µ—Ä—Ö—É)
  const notifications = useMemo(() => {
    // –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è + —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ unread/read
    return [...unread, ...read]
  }, [notificationsQuery.data])

  // 5. WebSocket –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
  useEffect(() => {
    const handleNewNotification = (payload) => {
      // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–µ—à React Query
    }
    
    const unsubscribe = subscribeToEvent(
      'notifications',
      handleNewNotification
    )
    
    return () => unsubscribe()
  }, [queryClient])

  return { notifications, unreadCount, ... }
}
```

---

### 2. `NotificationBell` Component

**–§–∞–π–ª:** `src/widgets/notifications/ui/NotificationBell.tsx`

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫–∞ —Å –±–µ–π–¥–∂–µ–º
- Dropdown –º–µ–Ω—é —Å–æ —Å–ø–∏—Å–∫–æ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- Infinite scroll –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**

```typescript
export const NotificationBell = () => {
  // 1. State
  const [open, setOpen] = useState(false)
  
  // 2. Refs –¥–ª—è infinite scroll
  const listRef = useRef<HTMLDivElement>(null)
  const observerTargetRef = useRef<HTMLDivElement>(null)
  
  // 3. –î–∞–Ω–Ω—ã–µ –∏–∑ —Ö—É–∫–∞
  const {
    notifications,
    unreadCount,
    isLoading,
    markAsRead,
    hasNextPage,
    isFetchingNextPage,
    fetchNextPage
  } = useNotifications()
  
  // 4. Infinite scroll
  useInfiniteScroll({
    targetRef: observerTargetRef,
    rootRef: listRef,
    hasNextPage: hasNextPage ?? false,
    isFetchingNextPage,
    fetchNextPage: () => void fetchNextPage(),
    enabled: open
  })
  
  // 5. Render
  return (
    <DropdownMenu.Root>
      {/* Trigger —Å –±–µ–π–¥–∂–µ–º */}
      {/* –°–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */}
      {/* Observer target –¥–ª—è infinite scroll */}
    </DropdownMenu.Root>
  )
}
```

---

### 3. `notificationApi`

**–§–∞–π–ª:** `src/entities/notification/api/notification.ts`

**–ú–µ—Ç–æ–¥—ã:**

#### `getAll(params)`
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```typescript
{
  cursor?: number           // ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ (–¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏)
  sortBy?: 'notifyAt'       // –ü–æ–ª–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
  sortDirection?: 'asc' | 'desc'
  pageSize?: number         // –†–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (default: 100)
  unreadFirst?: boolean     // –ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —Å–Ω–∞—á–∞–ª–∞ (default: true)
  isRead?: boolean          // –§–∏–ª—å—Ç—Ä –ø–æ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ—Å—Ç–∏
}
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```typescript
{
  items: Notification[]     // –ú–∞—Å—Å–∏–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  totalCount: number        // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
  notReadCount: number      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
}
```

**–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:**
```typescript
// –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
GET /notifications?pageSize=100&sortDirection=desc&unreadFirst=true

// –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (cursor = ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞)
GET /notifications/123?pageSize=100&sortDirection=desc&unreadFirst=true
```

#### `markAsRead(ids)`
–ü–æ–º–µ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```typescript
ids: number[]  // –ú–∞—Å—Å–∏–≤ ID —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```

**–ó–∞–ø—Ä–æ—Å:**
```typescript
PUT /notifications/mark-as-read
Body: { ids: [1, 2, 3] }
```

---

## –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   User      ‚îÇ
‚îÇ  –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç  ‚îÇ
‚îÇ  –∫–æ–º–ø–æ–Ω–µ–Ω—Ç  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  useNotifications()          ‚îÇ
‚îÇ  - useInfiniteQuery          ‚îÇ
‚îÇ    –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  notificationApi.getAll()    ‚îÇ
‚îÇ  GET /notifications          ‚îÇ
‚îÇ  ?pageSize=100               ‚îÇ
‚îÇ  &unreadFirst=true           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Server Response             ‚îÇ
‚îÇ  {                           ‚îÇ
‚îÇ    items: [...100 items],    ‚îÇ
‚îÇ    totalCount: 250,          ‚îÇ
‚îÇ    notReadCount: 15          ‚îÇ
‚îÇ  }                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  React Query Cache           ‚îÇ
‚îÇ  –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –∫–µ—à             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  useMemo (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞)        ‚îÇ
‚îÇ  - –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ ID        ‚îÇ
‚îÇ  - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ unread/read    ‚îÇ
‚îÇ  - –í–æ–∑–≤—Ä–∞—Ç [...unread, ...read]‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  UI Render                   ‚îÇ
‚îÇ  –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### 2. Infinite Scroll (–∑–∞–≥—Ä—É–∑–∫–∞ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   User      ‚îÇ
‚îÇ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç‚îÇ
‚îÇ   –¥–æ –∫–æ–Ω—Ü–∞  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  IntersectionObserver        ‚îÇ
‚îÇ  –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç observerTarget ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  useInfiniteScroll           ‚îÇ
‚îÇ  –≤—ã–∑—ã–≤–∞–µ—Ç fetchNextPage()    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  React Query                 ‚îÇ
‚îÇ  getNextPageParam            ‚îÇ
‚îÇ  –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç cursor (ID=100)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  notificationApi.getAll()    ‚îÇ
‚îÇ  GET /notifications/100      ‚îÇ
‚îÇ  ?pageSize=100               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Server Response             ‚îÇ
‚îÇ  {                           ‚îÇ
‚îÇ    items: [...100 items],    ‚îÇ
‚îÇ    totalCount: 250,          ‚îÇ
‚îÇ    notReadCount: 15          ‚îÇ
‚îÇ  }                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  React Query Cache           ‚îÇ
‚îÇ  –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É    ‚îÇ
‚îÇ  pages: [page1, page2]       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  useMemo –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è     ‚îÇ
‚îÇ  –¢–µ–ø–µ—Ä—å 200 —ç–ª–µ–º–µ–Ω—Ç–æ–≤        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  UI Render                   ‚îÇ
‚îÇ  –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç 200 —ç–ª–µ–º–µ–Ω—Ç–æ–≤    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### 3. –ü–æ–º–µ—Ç–∫–∞ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ (Optimistic Update)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   User      ‚îÇ
‚îÇ  –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ ‚îÇ
‚îÇ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  markAsRead(id, isRead)      ‚îÇ
‚îÇ  –ü—Ä–æ–≤–µ—Ä–∫–∞: isRead === false  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  useMutation.mutate([id])    ‚îÇ
‚îÇ                              ‚îÇ
‚îÇ  onMutate (–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ):    ‚îÇ
‚îÇ  1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å previousData   ‚îÇ
‚îÇ  2. –û–±–Ω–æ–≤–∏—Ç—å –∫–µ—à:            ‚îÇ
‚îÇ     - isRead = true          ‚îÇ
‚îÇ     - notReadCount -= 1      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ                         ‚îÇ
       ‚ñº                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  UI Update   ‚îÇ      ‚îÇ  API Request     ‚îÇ
‚îÇ  –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ   ‚îÇ      ‚îÇ  PUT /mark-as-read‚îÇ
‚îÇ  isRead=true ‚îÇ      ‚îÇ  Body: {ids:[id]}‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                ‚îÇ                     ‚îÇ
                ‚ñº                     ‚ñº
       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ   Success      ‚îÇ    ‚îÇ    Error      ‚îÇ
       ‚îÇ  –ù–∏—á–µ–≥–æ –Ω–µ     ‚îÇ    ‚îÇ  onError:     ‚îÇ
       ‚îÇ  –¥–µ–ª–∞–µ–º        ‚îÇ    ‚îÇ  –û—Ç–∫–∞—Ç –∫–µ—à–∞   ‚îÇ
       ‚îÇ                ‚îÇ    ‚îÇ  –∫ previous   ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                     ‚îÇ
                                     ‚ñº
                            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                            ‚îÇ  UI Rollback   ‚îÇ
                            ‚îÇ  isRead=false  ‚îÇ
                            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### 4. WebSocket (–Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Server    ‚îÇ
‚îÇ  –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ‚îÇ
‚îÇ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  WebSocket Connection        ‚îÇ
‚îÇ  socket.on('notifications')  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  subscribeToEvent            ‚îÇ
‚îÇ  –≤—ã–∑—ã–≤–∞–µ—Ç callback           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  handleNewNotification       ‚îÇ
‚îÇ  payload: Notification       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤         ‚îÇ
‚îÇ  existingIds.has(id)?        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ –î–∞ ‚îÄ‚îÄ> –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å
       ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ –ù–µ—Ç
            ‚îÇ
            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  queryClient.setQueryData    ‚îÇ
‚îÇ  –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –Ω–∞—á–∞–ª–æ:        ‚îÇ
‚îÇ  items: [new, ...old]        ‚îÇ
‚îÇ  notReadCount += 1           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  useMemo –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è     ‚îÇ
‚îÇ  –ù–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö—É    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  UI Render                   ‚îÇ
‚îÇ  –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ‚îÇ
‚îÇ  –ë–µ–π–¥–∂: unreadCount += 1     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## API

### Endpoints

#### 1. GET `/notifications`
–ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `sortBy` (string, default: 'notifyAt') - –ø–æ–ª–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- `sortDirection` (string, default: 'desc') - –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- `pageSize` (number, default: 100) - —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `unreadFirst` (boolean, default: true) - –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —Å–Ω–∞—á–∞–ª–∞
- `isRead` (boolean, optional) - —Ñ–∏–ª—å—Ç—Ä –ø–æ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ—Å—Ç–∏

**Response:**
```json
{
  "items": [
    {
      "id": 123,
      "message": "–ù–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ",
      "isRead": false,
      "createdAt": "2026-02-09T12:00:00Z",
      "notifyAt": "2026-02-09T12:00:00Z"
    }
  ],
  "totalCount": 250,
  "notReadCount": 15
}
```

---

#### 2. GET `/notifications/:cursor`
–ü–æ–ª—É—á–∏—Ç—å —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É

**Path –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `cursor` (number) - ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:** (—Ç–µ –∂–µ, —á—Ç–æ –∏ –¥–ª—è –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã)

**Response:** (—Ç–æ—Ç –∂–µ —Ñ–æ—Ä–º–∞—Ç)

---

#### 3. PUT `/notifications/mark-as-read`
–ü–æ–º–µ—Ç–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ

**Body:**
```json
{
  "ids": [1, 2, 3]
}
```

**Response:** 204 No Content

---

## WebSocket

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

**URL:** `wss://inctagram.work`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```typescript
{
  query: { accessToken: 'user_token' },
  transports: ['websocket']
}
```

### –°–æ–±—ã—Ç–∏—è

#### `notifications`
–ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**Payload (–æ–¥–∏–Ω–æ—á–Ω–æ–µ):**
```json
{
  "id": 456,
  "message": "–ù–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ",
  "isRead": false,
  "createdAt": "2026-02-09T12:30:00Z",
  "notifyAt": "2026-02-09T12:30:00Z"
}
```

**Payload (–º–∞—Å—Å–∏–≤):**
```json
[
  { "id": 456, "message": "...", "isRead": false },
  { "id": 457, "message": "...", "isRead": false }
]
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º

**–§–∞–π–ª:** `src/entities/notification/model/socket/getSocket.ts`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- Singleton –ø–∞—Ç—Ç–µ—Ä–Ω (–æ–¥–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ —Å–≤—è–∑–∏
- –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–æ–∫–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏ —á–µ—Ä–µ–∑ `localStorage`

**–°–æ–±—ã—Ç–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**
```typescript
socket.on('connect', () => {
  console.log('[Socket] –ü–æ–¥–∫–ª—é—á–µ–Ω')
})

socket.on('disconnect', (reason) => {
  console.log('[Socket] –û—Ç–∫–ª—é—á–µ–Ω:', reason)
})

socket.on('connect_error', (error) => {
  console.error('[Socket] –û—à–∏–±–∫–∞:', error)
})
```

---

## –ü–∞–≥–∏–Ω–∞—Ü–∏—è

### Cursor-based Pagination

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫—É—Ä—Å–æ—Ä–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è –ø–æ `id` —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å –ø—Ä–æ–ø—É—Å–∫–æ–º —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è –¥–∞–∂–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

```typescript
// –°—Ç—Ä–∞–Ω–∏—Ü–∞ 1
GET /notifications?pageSize=100
Response: { items: [id:100, id:99, ..., id:1] }

// –°—Ç—Ä–∞–Ω–∏—Ü–∞ 2 (cursor = ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ = 1)
GET /notifications/1?pageSize=100
Response: { items: [id:0, id:-1, ..., id:-99] }

// –ò —Ç–∞–∫ –¥–∞–ª–µ–µ...
```

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–ª–∏—á–∏—è —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**

```typescript
getNextPageParam: (lastPage) => {
  // –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ–ø–æ–ª–Ω–∞—è - –¥–∞–Ω–Ω—ã—Ö –±–æ–ª—å—à–µ –Ω–µ—Ç
  if (lastPage.items.length < 100) {
    return undefined // hasNextPage = false
  }
  
  // Cursor = ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
  return lastPage.items[lastPage.items.length - 1]?.id
}
```

---

## –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

### –°–µ—Ä–≤–µ—Ä–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

–°–µ—Ä–≤–µ—Ä –æ—Ç–¥–∞—ë—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `unreadFirst=true`:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ (–ø–æ –¥–∞—Ç–µ desc)    ‚îÇ
‚îÇ - id: 150, isRead: false        ‚îÇ
‚îÇ - id: 140, isRead: false        ‚îÇ
‚îÇ - id: 130, isRead: false        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –ü—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ (–ø–æ –¥–∞—Ç–µ desc)      ‚îÇ
‚îÇ - id: 120, isRead: true         ‚îÇ
‚îÇ - id: 110, isRead: true         ‚îÇ
‚îÇ - id: 100, isRead: true         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç:

```typescript
const notifications = useMemo(() => {
  // 1. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ ID
  const uniqueById = new Map<number, Notification>()
  pages.forEach(page => {
    page.items.forEach(item => {
      if (!uniqueById.has(item.id)) {
        uniqueById.set(item.id, item)
      }
    })
  })
  
  // 2. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –∏ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
  const unread: Notification[] = []
  const read: Notification[] = []
  
  Array.from(uniqueById.values()).forEach(notification => {
    if (notification.isRead) {
      read.push(notification)
    } else {
      unread.push(notification)
    }
  })
  
  // 3. –ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ –≤–≤–µ—Ä—Ö—É
  return [...unread, ...read]
}, [notificationsQuery.data])
```

**–ó–∞—á–µ–º –Ω—É–∂–Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞?**

–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–ø–æ–º–µ—Ç–∫–∞ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ) —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å—Å—è –≤–Ω–∏–∑:

```
–î–æ –∫–ª–∏–∫–∞:                    –ü–æ—Å–ª–µ –∫–ª–∏–∫–∞:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ   ‚îÇ         ‚îÇ –ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ   ‚îÇ
‚îÇ - id: 150 ‚ùå    ‚îÇ         ‚îÇ - id: 140 ‚ùå    ‚îÇ
‚îÇ - id: 140 ‚ùå    ‚îÇ         ‚îÇ - id: 130 ‚ùå    ‚îÇ
‚îÇ - id: 130 ‚ùå    ‚îÇ         ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§         ‚îÇ –ü—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ     ‚îÇ
‚îÇ –ü—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ     ‚îÇ         ‚îÇ - id: 150 ‚úÖ ‚¨Ö –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–æ—Å—å
‚îÇ - id: 120 ‚úÖ    ‚îÇ         ‚îÇ - id: 120 ‚úÖ    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. React Query –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```typescript
{
  staleTime: Infinity,           // –î–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã (WebSocket)
  gcTime: 5 * 60 * 1000,         // –ö–µ—à –∂–∏–≤—ë—Ç 5 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ unmount
  refetchOnWindowFocus: false,   // –ù–µ —Ä–µ—Ñ–µ—Ç—á–∏–º –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ (–µ—Å—Ç—å WebSocket)
  retry: 1                       // –û–¥–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ
}
```

### 2. –ú–µ–º–æ–∏–∑–∞—Ü–∏—è

```typescript
// useMemo –¥–ª—è —Å–ø–∏—Å–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
const notifications = useMemo(() => {
  // –¢—è–∂—ë–ª—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è (–¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è + —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞)
}, [notificationsQuery.data])

// useCallback –¥–ª—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
const markAsRead = useCallback(
  (id, isRead) => { ... },
  [mutateMarkAsRead]
)
```

### 3. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Map

```typescript
// O(1) –ø–æ–∏—Å–∫ –≤–º–µ—Å—Ç–æ O(n)
const uniqueById = new Map<number, Notification>()

pages.forEach(page => {
  page.items.forEach(item => {
    if (!uniqueById.has(item.id)) {  // O(1)
      uniqueById.set(item.id, item)  // O(1)
    }
  })
})
```

### 4. –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–ª–∏–∫ UI –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞:

```typescript
onMutate: async (ids) => {
  // 1. –û—Ç–º–µ–Ω—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
  await queryClient.cancelQueries({ queryKey: QUERY_KEY })
  
  // 2. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–¥–ª—è –æ—Ç–∫–∞—Ç–∞)
  const previousData = queryClient.getQueryData(QUERY_KEY)
  
  // 3. –û–±–Ω–æ–≤–ª—è–µ–º –∫–µ—à –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ
  queryClient.setQueryData(QUERY_KEY, (oldData) => {
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ isRead = true
  })
  
  // 4. –í–æ–∑–≤—Ä–∞—â–∞–µ–º context –¥–ª—è –æ—Ç–∫–∞—Ç–∞
  return { previousData }
}

onError: (error, variables, context) => {
  // –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–µ
  queryClient.setQueryData(QUERY_KEY, context.previousData)
}
```

### 5. Infinite Scroll –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

```typescript
useInfiniteScroll({
  threshold: 0.5,      // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏ 50% –≤–∏–¥–∏–º–æ—Å—Ç–∏
  rootMargin: '50px',  // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞ 50px –¥–æ –∫–æ–Ω—Ü–∞
  enabled: open        // –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ dropdown –æ—Ç–∫—Ä—ã—Ç
})
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```typescript
import { useNotifications } from '@/entities/notification'

function MyComponent() {
  const {
    notifications,
    unreadCount,
    isLoading,
    markAsRead
  } = useNotifications()
  
  if (isLoading) return <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>
  
  return (
    <div>
      <h2>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ({unreadCount})</h2>
      {notifications.map(notification => (
        <div
          key={notification.id}
          onClick={() => markAsRead(notification.id, notification.isRead)}
        >
          {notification.message}
        </div>
      ))}
    </div>
  )
}
```

### –° Infinite Scroll

```typescript
import { useRef } from 'react'
import { useNotifications } from '@/entities/notification'
import { useInfiniteScroll } from '@/shared/lib/hooks/useInfiniteScroll'

function NotificationList() {
  const listRef = useRef<HTMLDivElement>(null)
  const observerRef = useRef<HTMLDivElement>(null)
  
  const {
    notifications,
    hasNextPage,
    isFetchingNextPage,
    fetchNextPage
  } = useNotifications()
  
  useInfiniteScroll({
    targetRef: observerRef,
    rootRef: listRef,
    hasNextPage: hasNextPage ?? false,
    isFetchingNextPage,
    fetchNextPage: () => void fetchNextPage()
  })
  
  return (
    <div ref={listRef} style={{ maxHeight: '500px', overflow: 'auto' }}>
      {notifications.map(n => (
        <div key={n.id}>{n.message}</div>
      ))}
      
      {hasNextPage && (
        <div ref={observerRef}>
          {isFetchingNextPage && '–ó–∞–≥—Ä—É–∑–∫–∞...'}
        </div>
      )}
    </div>
  )
}
```

### –¢–æ–ª—å–∫–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ

```typescript
function UnreadNotifications() {
  const { notifications, unreadCount } = useNotifications()
  
  const unreadOnly = notifications.filter(n => !n.isRead)
  
  return (
    <div>
      <h2>–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ ({unreadCount})</h2>
      {unreadOnly.map(n => (
        <div key={n.id}>{n.message}</div>
      ))}
    </div>
  )
}
```

---

## Troubleshooting

### WebSocket –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ real-time

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ `accessToken` –≤ localStorage
2. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network ‚Üí WS
3. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π WebSocket –Ω–∞ `wss://inctagram.work`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### –î—É–±–ª–∏—Ä—É—é—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–¥–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä `useNotifications`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ—Ç —Ä—É—á–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–µ—à
3. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ ID –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç infinite scroll

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `observerTargetRef` –ø–µ—Ä–µ–¥–∞–Ω –≤ —ç–ª–µ–º–µ–Ω—Ç
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `enabled: true` –≤ `useInfiniteScroll`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `rootRef` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ —Å–∫—Ä–æ–ª–ª–æ–º
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `hasNextPage` - –≤–æ–∑–º–æ–∂–Ω–æ, –¥–∞–Ω–Ω—ã—Ö –±–æ–ª—å—à–µ –Ω–µ—Ç

### –ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –Ω–µ –≤–≤–µ—Ä—Ö—É

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –∏ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ—à–∞–Ω—ã

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `unreadFirst: true` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ API
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Å–º. useMemo)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Å–ª–µ `markAsRead` –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–µ—Ä–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ú–µ—Ç—Ä–∏–∫–∏

- **–ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞:** ~200-300ms
- **Infinite scroll:** ~100-150ms
- **–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** ~0ms (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
- **WebSocket latency:** ~50-100ms

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏

- **Garbage Collection:** –ö–µ—à –æ—á–∏—â–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ unmount
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:** –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã –≤ –ø–∞–º—è—Ç–∏
- **Pagination:** –ù–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É

---

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### ‚úÖ DO

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä `useNotifications` –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ `hasNextPage` –ø–µ—Ä–µ–¥ `fetchNextPage`
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `useInfiniteScroll` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–¥–≥—Ä—É–∑–∫–∏
4. –ü–æ–ª–∞–≥–∞–π—Ç–µ—Å—å –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É (–Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –≤–≤–µ—Ä—Ö—É)
5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –ª—É—á—à–µ–≥–æ UX

### ‚ùå DON'T

1. –ù–µ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å–≤–æ–π WebSocket - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π
2. –ù–µ –ø–µ—Ä–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤—ã–≤–∞–π—Ç–µ `notifications` –≤—Ä—É—á–Ω—É—é
3. –ù–µ –≤—ã–∑—ã–≤–∞–π—Ç–µ `fetchNextPage` –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ `hasNextPage`
4. –ù–µ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ `useNotifications`
5. –ù–µ –¥–µ–ª–∞–π—Ç–µ —Ä—É—á–Ω–æ–π —Ä–µ—Ñ–µ—Ç—á - WebSocket –æ–±–Ω–æ–≤–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö –∏ –ª—É—á—à–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫–∞—Ö:

- ‚úÖ **React Query** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- ‚úÖ **WebSocket** –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- ‚úÖ **Infinite Scroll** –¥–ª—è –ø–ª–∞–≤–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ **Optimistic Updates** –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ—Ç–∫–ª–∏–∫–∞
- ‚úÖ **FSD Architecture** –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏
- ‚úÖ **TypeScript** –¥–ª—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç—ã—Å—è—á–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ.
