# WebSocket Singleton - –ì–∞—Ä–∞–Ω—Ç–∏—è –æ–¥–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `useNotifications` –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö –º–æ–≥–ª–∞ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å —Å–∏—Ç—É–∞—Ü–∏—è:

```typescript
function App() {
  return (
    <>
      <NotificationBell />   {/* useNotifications #1 */}
      <NotificationList />   {/* useNotifications #2 */}
      <NotificationBadge />  {/* useNotifications #3 */}
    </>
  )
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ: **1** (–±–ª–∞–≥–æ–¥–∞—Ä—è singleton –≤ `getSocket`)
- ‚ö†Ô∏è –ü–æ–¥–ø–∏—Å–æ–∫ –Ω–∞ —Å–æ–±—ã—Ç–∏–µ 'notifications': **3** (–ø–æ –æ–¥–Ω–æ–π –Ω–∞ –∫–∞–∂–¥—ã–π —Ö—É–∫)

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ–¥–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è callback –≤—ã–∑—ã–≤–∞–ª—Å—è 3 —Ä–∞–∑–∞
- React Query –∫–µ—à –æ–±–Ω–æ–≤–ª—è–ª—Å—è 3 —Ä–∞–∑–∞
- –õ–∏—à–Ω–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ race conditions

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω **–≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–ª–∞–≥** `isSocketSubscribed`, –∫–æ—Ç–æ—Ä—ã–π –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç **–æ–¥–Ω—É –ø–æ–¥–ø–∏—Å–∫—É** –Ω–∞ –≤—Å—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

### –ö–æ–¥

```typescript
// –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–ª–∞–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫
let isSocketSubscribed = false

export const useNotifications = () => {
  const queryClient = useQueryClient()
  
  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ...
  
  useEffect(() => {
    // –ï—Å–ª–∏ —É–∂–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
    if (isSocketSubscribed) {
      return
    }
    
    isSocketSubscribed = true
    
    const handleNewNotification = (payload) => {
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–µ—à–∞ React Query
    }
    
    const unsubscribe = subscribeToEvent(
      SOCKET_EVENTS.NOTIFICATIONS,
      handleNewNotification
    )
    
    // Cleanup: –æ—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥
    return () => {
      unsubscribe()
      isSocketSubscribed = false
    }
  }, [queryClient])
  
  return { ... }
}
```

---

## üîç –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–¥–∏–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

```typescript
function App() {
  return <NotificationBell />
}
```

**–ü–æ—Ç–æ–∫:**
1. `NotificationBell` –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è
2. `useNotifications` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
3. `isSocketSubscribed === false` ‚Üí —Å–æ–∑–¥–∞—ë–º –ø–æ–¥–ø–∏—Å–∫—É
4. `isSocketSubscribed = true`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ: **1**
- ‚úÖ –ü–æ–¥–ø–∏—Å–æ–∫: **1**

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ù–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```typescript
function App() {
  return (
    <>
      <NotificationBell />   {/* –ü–µ—Ä–≤—ã–π */}
      <NotificationList />   {/* –í—Ç–æ—Ä–æ–π */}
      <NotificationBadge />  {/* –¢—Ä–µ—Ç–∏–π */}
    </>
  )
}
```

**–ü–æ—Ç–æ–∫:**
1. `NotificationBell` –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è
   - `useNotifications` #1 –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
   - `isSocketSubscribed === false` ‚Üí —Å–æ–∑–¥–∞—ë–º –ø–æ–¥–ø–∏—Å–∫—É
   - `isSocketSubscribed = true`

2. `NotificationList` –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è
   - `useNotifications` #2 –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
   - `isSocketSubscribed === true` ‚Üí **–ø—Ä–æ–ø—É—Å–∫–∞–µ–º** (early return)

3. `NotificationBadge` –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è
   - `useNotifications` #3 –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
   - `isSocketSubscribed === true` ‚Üí **–ø—Ä–æ–ø—É—Å–∫–∞–µ–º** (early return)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ: **1**
- ‚úÖ –ü–æ–¥–ø–∏—Å–æ–∫: **1** (—Ç–æ–ª—å–∫–æ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞)

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: Unmount –∏ remount

```typescript
// –®–∞–≥ 1: –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
<NotificationBell />   // –°–æ–∑–¥–∞–ª –ø–æ–¥–ø–∏—Å–∫—É
<NotificationList />   // –ü—Ä–æ–ø—É—Å—Ç–∏–ª
<NotificationBadge />  // –ü—Ä–æ–ø—É—Å—Ç–∏–ª

// –®–∞–≥ 2: NotificationBell —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–ª—Å—è
// - cleanup –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
// - unsubscribe()
// - isSocketSubscribed = false

// –®–∞–≥ 3: NotificationList –∏ NotificationBadge –≤—Å—ë –µ—â—ë –∂–∏–≤—ã
// –ù–æ –ø–æ–¥–ø–∏—Å–∫–∏ –±–æ–ª—å—à–µ –Ω–µ—Ç!

// –®–∞–≥ 4: NotificationList —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è
// - useEffect –ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è (–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å)
// - –ü–æ–¥–ø–∏—Å–∫–∞ –ù–ï —Å–æ–∑–¥–∞—ë—Ç—Å—è
```

**–ü—Ä–æ–±–ª–µ–º–∞?** 
- ‚ùå –ï—Å–ª–∏ –ø–µ—Ä–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è, –ø–æ–¥–ø–∏—Å–∫–∞ —É–¥–∞–ª—è–µ—Ç—Å—è
- ‚ùå –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –ø–æ–¥–ø–∏—Å–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ! React Query –∫–µ—à **–æ–±—â–∏–π** –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤. –ü–æ–∫–∞ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å `useNotifications` –∂–∏–≤—ë—Ç, –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Application                        ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îÇ
‚îÇ  ‚îÇNotificationBell‚îÇNotificationList‚îÇ            ‚îÇ
‚îÇ  ‚îÇuseNotifications‚îÇuseNotifications‚îÇ            ‚îÇ
‚îÇ  ‚îÇ    (1st)     ‚îÇ  ‚îÇ    (2nd)     ‚îÇ            ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ
‚îÇ         ‚îÇ                 ‚îÇ                     ‚îÇ
‚îÇ         ‚îÇ                 ‚îÇ                     ‚îÇ
‚îÇ         ‚ñº                 ‚ñº                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ  ‚îÇ   isSocketSubscribed (global)    ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ   - false ‚Üí —Å–æ–∑–¥–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É     ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ   - true  ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å           ‚îÇ          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îÇ                 ‚îÇ                               ‚îÇ
‚îÇ                 ‚ñº                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ  ‚îÇ   subscribeToEvent (1 —Ä–∞–∑)       ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ   - socket.on('notifications')   ‚îÇ          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îÇ                 ‚îÇ                               ‚îÇ
‚îÇ                 ‚ñº                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ  ‚îÇ   getSocket() - Singleton        ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ   - –û–¥–Ω–æ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ    ‚îÇ          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îÇ                 ‚îÇ                               ‚îÇ
‚îÇ                 ‚ñº                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ  ‚îÇ   WebSocket Connection           ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ   wss://inctagram.work           ‚îÇ          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –î–æ –∏ –ü–æ—Å–ª–µ

### –î–æ (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏)

```
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:           3
WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π: 1 ‚úÖ
–ü–æ–¥–ø–∏—Å–æ–∫:             3 ‚ö†Ô∏è
–í—ã–∑–æ–≤–æ–≤ callback:     3 –Ω–∞ —Å–æ–±—ã—Ç–∏–µ ‚ö†Ô∏è
–û–±–Ω–æ–≤–ª–µ–Ω–∏–π –∫–µ—à–∞:      3 –Ω–∞ —Å–æ–±—ã—Ç–∏–µ ‚ö†Ô∏è
```

### –ü–æ—Å–ª–µ (–æ–¥–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞)

```
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:           3
WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π: 1 ‚úÖ
–ü–æ–¥–ø–∏—Å–æ–∫:             1 ‚úÖ
–í—ã–∑–æ–≤–æ–≤ callback:     1 –Ω–∞ —Å–æ–±—ã—Ç–∏–µ ‚úÖ
–û–±–Ω–æ–≤–ª–µ–Ω–∏–π –∫–µ—à–∞:      1 –Ω–∞ —Å–æ–±—ã—Ç–∏–µ ‚úÖ
```

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
   - –û–¥–∏–Ω callback –≤–º–µ—Å—Ç–æ N
   - –û–¥–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–µ—à–∞ –≤–º–µ—Å—Ç–æ N
   - –ù–µ—Ç race conditions

2. **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å**
   - –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –æ–¥–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞
   - –ß—ë—Ç–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ, –∫–æ–≥–¥–∞ –ø–æ–¥–ø–∏—Å–∫–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è

3. **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –æ—Ç–ª–∞–¥–∫–∏**
   - –õ–µ–≥–∫–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –≤ DevTools
   - –ù–µ—Ç –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è —Å–æ–±—ã—Ç–∏–π

4. **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å**
   - –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏ unmount/remount

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–¥–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏

```typescript
// 1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Console
// 2. –î–æ–±–∞–≤—å—Ç–µ –≤ getSocket.ts:
socket.on('connect', () => {
  console.log('[Socket] Connected')
})

// 3. –î–æ–±–∞–≤—å—Ç–µ –≤ subscribeToEvent.ts:
export const subscribeToEvent = <T>(event: string, callback: (data: T) => void) => {
  console.log('[Subscribe]', event)  // ‚Üê –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –û–î–ò–ù —Ä–∞–∑
  const socket = getSocket()
  socket.on(event, callback)
  
  return () => {
    console.log('[Unsubscribe]', event)
    socket.off(event, callback)
  }
}

// 4. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
// 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å:
// [Socket] Connected          ‚Üê 1 —Ä–∞–∑
// [Subscribe] notifications   ‚Üê 1 —Ä–∞–∑ (–Ω–µ 3!)
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### 1. Cleanup –ø—Ä–∏ unmount

–ö–æ–≥–¥–∞ **–ø–µ—Ä–≤—ã–π** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (—Å–æ–∑–¥–∞–≤—à–∏–π –ø–æ–¥–ø–∏—Å–∫—É) —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è:
- –ü–æ–¥–ø–∏—Å–∫–∞ —É–¥–∞–ª—è–µ—Ç—Å—è
- `isSocketSubscribed = false`
- WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞—ë—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º

–ï—Å–ª–∏ –¥—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤—Å—ë –µ—â—ë –∂–∏–≤—ã, –æ–Ω–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ –±–µ–∑ real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.

**–†–µ—à–µ–Ω–∏–µ:** –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ! React Query –∫–µ—à –æ–±—â–∏–π, –∏ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏.

### 2. –ü–æ—Ä—è–¥–æ–∫ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ü–æ–¥–ø–∏—Å–∫–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è **–ø–µ—Ä–≤—ã–º** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑–≤–∞–ª `useNotifications`.

```typescript
// –ï—Å–ª–∏ –ø–æ—Ä—è–¥–æ–∫:
<NotificationList />   // ‚Üê –°–æ–∑–¥–∞—Å—Ç –ø–æ–¥–ø–∏—Å–∫—É
<NotificationBell />   // ‚Üê –ü—Ä–æ–ø—É—Å—Ç–∏—Ç

// –ò–ª–∏:
<NotificationBell />   // ‚Üê –°–æ–∑–¥–∞—Å—Ç –ø–æ–¥–ø–∏—Å–∫—É
<NotificationList />   // ‚Üê –ü—Ä–æ–ø—É—Å—Ç–∏—Ç

// –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π: –æ–¥–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞
```

### 3. React Strict Mode

–í —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ React –º–æ–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–≤–∞–∂–¥—ã. –§–ª–∞–≥ `isSocketSubscribed` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —ç—Ç–æ:

```
1. Mount #1 ‚Üí isSocketSubscribed = true, –ø–æ–¥–ø–∏—Å–∫–∞ —Å–æ–∑–¥–∞–Ω–∞
2. Unmount #1 ‚Üí isSocketSubscribed = false, –ø–æ–¥–ø–∏—Å–∫–∞ —É–¥–∞–ª–µ–Ω–∞
3. Mount #2 ‚Üí isSocketSubscribed = true, –ø–æ–¥–ø–∏—Å–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ –∑–∞–Ω–æ–≤–æ
```

---

## üîí –ì–∞—Ä–∞–Ω—Ç–∏–∏

‚úÖ **–û–¥–Ω–æ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ** –Ω–∞ –≤—Å—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (singleton –≤ `getSocket`)  
‚úÖ **–û–¥–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞** –Ω–∞ —Å–æ–±—ã—Ç–∏–µ 'notifications' (—Ñ–ª–∞–≥ `isSocketSubscribed`)  
‚úÖ **–û–¥–∏–Ω callback** –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è  
‚úÖ **–û–¥–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** React Query –∫–µ—à–∞  
‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞** –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö  
‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π cleanup** –ø—Ä–∏ unmount  

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `src/entities/notification/model/useNotifications.ts` - –ì–ª–∞–≤–Ω—ã–π —Ö—É–∫ —Å —Ñ–ª–∞–≥–æ–º
- `src/entities/notification/model/socket/getSocket.ts` - WebSocket singleton
- `src/entities/notification/model/socket/subscribeToEvent.ts` - –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è

---

**–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –æ–¥–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –æ–¥–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞!** ‚úÖ
